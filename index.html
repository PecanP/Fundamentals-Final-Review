<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Fundamentals Final Review — Unique Scenario Exam (60)</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;background:#0b1020;color:#e9eefc}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:#121a33;border:1px solid #22305e;border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 6px;font-size:18px}
    .muted{color:#a9b6e8}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{background:#0f1730;border:1px solid #22305e;padding:6px 10px;border-radius:999px;font-size:12px;color:#c7d2ff}
    .btn{appearance:none;border:1px solid #2a3a76;background:#1a2550;color:#e9eefc;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:650}
    .btn.secondary{background:#0f1730}
    .btn.good{border-color:#2a7a4f;background:#153a2b}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .hr{height:1px;background:#22305e;margin:12px 0}
    .qtext{font-size:16px;line-height:1.35;margin:10px 0}
    .opts{display:grid;gap:10px;margin-top:10px}
    label.opt{display:flex;gap:10px;align-items:flex-start;background:#0f1730;border:1px solid #22305e;border-radius:12px;padding:10px 12px;cursor:pointer}
    label.opt:hover{border-color:#3a54b0}
    input[type="radio"],input[type="checkbox"]{margin-top:2px;transform:scale(1.15)}
    .inputbox{width:320px;max-width:100%;background:#0f1730;border:1px solid #22305e;border-radius:10px;color:#e9eefc;padding:10px 12px;font-size:16px}
    .feedback{margin-top:12px;padding:12px;border-radius:12px;border:1px solid #22305e;background:#0f1730}
    .feedback.good{border-color:#2a7a4f}
    .feedback.bad{border-color:#8a2d2d}
    .tag{display:inline-block;font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid #22305e;color:#c7d2ff;margin-right:6px}
    .tiny{font-size:12px;color:#a9b6e8}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app"></div>
    <div class="tiny" style="margin-top:12px;">
      New question set built from general Fundamentals principles (not from your uploaded quizzes). Order shuffles each run. No duplicates inside the exam.
    </div>
  </div>

<script>
/* =========================
   UNIQUE SCENARIO EXAM (60)
   - Not derived from user-uploaded proprietary questions
   - Mixed formats: single | sata | numeric
   - Shuffles order each run
   - No repeats within exam
   ========================= */

const QUESTIONS = [
  // ---------- Med math & safe admin (10) ----------
  {id:1,type:"numeric",topic:"Dosage Calc",
   prompt:"Order: furosemide 30 mg IV now. Supply: 10 mg/mL. Round to nearest tenth. How many mL will you administer?",
   ansN:{v:3.0,t:0.05}, rat:"30 ÷ 10 = 3.0 mL."},

  {id:2,type:"numeric",topic:"Dosage Calc",
   prompt:"Order: amoxicillin 750 mg PO. Available: 250 mg capsules. How many capsules will you give? (Whole number)",
   ansN:{v:3,t:0}, rat:"750 ÷ 250 = 3 capsules."},

  {id:3,type:"numeric",topic:"Dosage Calc",
   prompt:"Order: 1.25 g vancomycin IV. Available: 500 mg vials. How many vials are needed? (Whole number)",
   ansN:{v:3,t:0}, rat:"1.25 g = 1250 mg. 1250 ÷ 500 = 2.5 → need 3 vials."},

  {id:4,type:"numeric",topic:"Weight-Based Dose",
   prompt:"A patient weighs 176 lb. Order: medication 0.5 mg/kg. Round to nearest whole mg. What is the dose (mg)?",
   ansN:{v:40,t:0}, rat:"176 ÷ 2.2 = 80 kg. 0.5 mg/kg × 80 = 40 mg."},

  {id:5,type:"numeric",topic:"IV Rate",
   prompt:"Infuse 900 mL NS over 6 hours via pump. What rate (mL/hr) should you set? (Whole number)",
   ansN:{v:150,t:0}, rat:"900 ÷ 6 = 150 mL/hr."},

  {id:6,type:"numeric",topic:"Drops/min",
   prompt:"Infuse 500 mL over 4 hours using a tubing drop factor of 20 gtt/mL. Round to whole gtt/min. What is the rate?",
   ansN:{v:42,t:0}, rat:"(500 mL × 20) ÷ 240 min = 41.67 → 42 gtt/min."},

  {id:7,type:"single",topic:"Medication Safety",
   prompt:"During med pass, the wristband is missing. The patient states their name and DOB correctly. What should the nurse do next?",
   options:[
     "Give the medication since the patient stated name and DOB",
     "Ask a family member to verify identity and give the medication",
     "Apply a replacement ID band per policy before administering",
     "Use the room number as the second identifier"
   ],
   ans:2, rat:"Two identifiers are required; replace the wristband per policy before medication administration."},

  {id:8,type:"single",topic:"High-Alert Meds",
   prompt:"Which medication requires independent double-check per common safety practice?",
   options:["Acetaminophen","Regular insulin","Docusate","Calcium carbonate"],
   ans:1, rat:"Insulin is high-alert and commonly requires an independent double-check per policy."},

  {id:9,type:"single",topic:"Do Not Crush",
   prompt:"A patient has an order for an extended-release tablet but has dysphagia. Best nursing action?",
   options:[
     "Crush and mix in pudding",
     "Split the tablet and give half now, half later",
     "Consult pharmacy/provider for an alternative formulation",
     "Dissolve the tablet in hot tea"
   ],
   ans:2, rat:"Extended-release/enteric-coated meds should not be crushed; request an alternate form."},

  {id:10,type:"sata",topic:"6 Rights + Safety",
   prompt:"Which actions reduce medication error risk? (Select all that apply.)",
   options:[
     "Compare label to MAR when removing from storage",
     "Use room number as an identifier if the patient is asleep",
     "Clarify unclear orders before giving",
     "Perform bedside label-to-MAR check",
     "Document the med as given before administering"
   ],
   ans:[0,2,3], rat:"Use checks and clarify orders. Room number isn’t an identifier; document after administering."},

  // ---------- Oxygenation & respiratory (10) ----------
  {id:11,type:"single",topic:"Priority (ABCs)",
   prompt:"A post-op patient calls and says, “I feel tight in my chest.” You note audible wheezing and the patient is struggling to speak full sentences. What is the priority action?",
   options:[
     "Offer ice chips and reassess",
     "Administer oxygen per protocol and call for immediate help per policy",
     "Finish documenting and then assess",
     "Encourage slow breathing and leave to get vitals equipment"
   ],
   ans:1, rat:"Airway/breathing compromise: oxygen and urgent escalation per protocol/policy."},

  {id:12,type:"sata",topic:"Early Hypoxia",
   prompt:"Which findings are consistent with early hypoxia? (Select all that apply.)",
   options:[
     "Restlessness",
     "Bradycardia",
     "Tachypnea",
     "New confusion",
     "Central cyanosis"
   ],
   ans:[0,2,3], rat:"Early signs: restlessness, tachypnea, confusion. Cyanosis/bradycardia are later."},

  {id:13,type:"single",topic:"Oxygen Devices",
   prompt:"Which device is most appropriate for a patient needing a precise FiO₂ for titration?",
   options:["Venturi mask","Simple face mask","Nasal cannula","Partial rebreather"],
   ans:0, rat:"Venturi provides the most precise oxygen concentration."},

  {id:14,type:"single",topic:"Incentive Spirometer",
   prompt:"Which instruction is correct for incentive spirometry use?",
   options:[
     "Blow forcefully into the device 10 times per hour",
     "Inhale slowly and deeply to raise the indicator, then hold breath briefly",
     "Use only before sleep",
     "Use immediately after meals while lying flat"
   ],
   ans:1, rat:"IS promotes lung expansion via slow deep inhalation with a brief breath hold."},

  {id:15,type:"single",topic:"Resp Assessment",
   prompt:"A patient’s RR is 10/min after opioid administration and they are difficult to arouse. Priority nursing action?",
   options:[
     "Document the finding and reassess in 1 hour",
     "Stimulate the patient, assess airway/breathing, and notify provider/rapid response per policy",
     "Give PRN antiemetic",
     "Encourage oral fluids"
   ],
   ans:1, rat:"Possible opioid-induced respiratory depression: intervene on ABCs and escalate per policy."},

  {id:16,type:"single",topic:"Positioning",
   prompt:"Which position best promotes lung expansion and eases dyspnea in an alert patient?",
   options:["High Fowler’s","Supine","Trendelenburg","Prone"],
   ans:0, rat:"High Fowler’s maximizes chest expansion and reduces work of breathing."},

  {id:17,type:"single",topic:"Breath Sounds",
   prompt:"Crackles in lung bases in a patient with heart failure most strongly suggest:",
   options:["Bronchospasm","Fluid in alveoli/pulmonary congestion","Upper airway obstruction","Pleural friction rub"],
   ans:1, rat:"Crackles often indicate fluid in the alveoli (pulmonary congestion/edema)."},

  {id:18,type:"single",topic:"Documentation",
   prompt:"Which documentation is best practice?",
   options:[
     "“Patient is dramatic and anxious.”",
     "“Patient is hypoxic after walking.”",
     "“After ambulating 20 feet: RR 30, SpO₂ 89% RA, using accessory muscles.”",
     "“Patient appears to be exaggerating.”"
   ],
   ans:2, rat:"Objective, measurable data is most defensible."},

  {id:19,type:"single",topic:"Aspiration Risk",
   prompt:"A patient with dysphagia coughs with thin liquids. Best nursing intervention?",
   options:[
     "Encourage rapid drinking to “get it down”",
     "Keep patient supine during meals",
     "Position upright and follow thickened-liquid/texture recommendations",
     "Give food in large bites to reduce chewing"
   ],
   ans:2, rat:"Upright positioning and texture modifications reduce aspiration risk."},

  {id:20,type:"single",topic:"Cough/Deep Breathing",
   prompt:"Why is turning, coughing, and deep breathing taught after surgery?",
   options:[
     "To prevent hypoglycemia",
     "To reduce atelectasis and mobilize secretions",
     "To decrease renal workload",
     "To improve appetite"
   ],
   ans:1, rat:"TCDB helps expand lungs, prevent atelectasis, and clear secretions."},

  // ---------- Fluids & electrolytes (10) ----------
  {id:21,type:"sata",topic:"Fluid Volume Deficit",
   prompt:"A patient with gastroenteritis is weak and dizzy when standing. Which findings support fluid volume deficit? (Select all that apply.)",
   options:[
     "Dry mucous membranes",
     "Decreased urine output",
     "Orthostatic hypotension",
     "Jugular venous distention",
     "Crackles"
   ],
   ans:[0,1,2], rat:"FVD: dry, low UO, orthostasis. JVD/crackles suggest excess."},

  {id:22,type:"sata",topic:"Fluid Volume Excess",
   prompt:"Which findings support fluid volume excess? (Select all that apply.)",
   options:[
     "Rapid weight gain",
     "Peripheral edema",
     "Crackles",
     "Poor skin turgor",
     "Thirst with dry mouth"
   ],
   ans:[0,1,2], rat:"FVE includes weight gain, edema, crackles. Poor turgor/dry mouth suggest deficit."},

  {id:23,type:"single",topic:"Perfusion Priority",
   prompt:"A patient with suspected dehydration has BP 86/52 and is lethargic. What is the priority concern?",
   options:["Impaired mobility","Decreased tissue perfusion","Risk for constipation","Disturbed sleep"],
   ans:1, rat:"Hypotension + lethargy = perfusion threat; address circulation."},

  {id:24,type:"single",topic:"I&O",
   prompt:"Which output is most concerning for an adult?",
   options:["45 mL/hr","35 mL/hr","20 mL/hr","55 mL/hr"],
   ans:2, rat:"< 30 mL/hr is commonly concerning; 20 mL/hr suggests possible hypoperfusion/AKI risk."},

  {id:25,type:"single",topic:"Electrolytes",
   prompt:"A patient reports muscle weakness and has ECG changes described as U waves. Most likely imbalance?",
   options:["Hypokalemia","Hyperkalemia","Hyponatremia","Hypercalcemia"],
   ans:0, rat:"U waves and weakness commonly suggest hypokalemia."},

  {id:26,type:"single",topic:"Electrolytes",
   prompt:"A patient with renal failure has peaked T waves on ECG. Most likely imbalance?",
   options:["Hyperkalemia","Hypokalemia","Hypocalcemia","Hypernatremia"],
   ans:0, rat:"Peaked T waves are classic for hyperkalemia."},

  {id:27,type:"single",topic:"Hyponatremia",
   prompt:"A patient with severe hyponatremia becomes confused and seizes. Priority nursing action?",
   options:[
     "Give water to raise sodium",
     "Protect airway, institute seizure precautions, and notify provider",
     "Encourage ambulation to reduce confusion",
     "Place supine with legs elevated and leave room"
   ],
   ans:1, rat:"Safety and airway first during seizure; urgent escalation required."},

  {id:28,type:"single",topic:"Daily Weights",
   prompt:"Why are daily weights preferred for assessing fluid status in hospitalized patients?",
   options:[
     "They are less invasive than BP measurement",
     "They detect short-term fluid changes more sensitively than edema or I&O alone",
     "They measure nutrition better than labs",
     "They replace the need for assessment"
   ],
   ans:1, rat:"Weight changes reflect fluid shifts early and reliably."},

  {id:29,type:"single",topic:"IV Complication",
   prompt:"An IV site is cool, swollen, and painful; infusion is running slowly. Best action?",
   options:[
     "Increase the rate to overcome resistance",
     "Stop infusion and remove IV; elevate and apply appropriate compress per policy",
     "Flush vigorously",
     "Document only"
   ],
   ans:1, rat:"Findings suggest infiltration; stop infusion and treat per protocol."},

  {id:30,type:"single",topic:"Acid-Base (Basic)",
   prompt:"A patient with prolonged vomiting is most likely to develop:",
   options:["Metabolic acidosis","Metabolic alkalosis","Respiratory acidosis","Respiratory alkalosis"],
   ans:1, rat:"Loss of gastric acid (H+) → metabolic alkalosis."},

  // ---------- Infection control & asepsis (6) ----------
  {id:31,type:"single",topic:"C. diff",
   prompt:"After caring for a patient with C. difficile, what hand hygiene is required?",
   options:["Alcohol sanitizer only","Soap and water","No hygiene if gloves were worn","Double-gloving next time"],
   ans:1, rat:"Spores require soap and water."},

  {id:32,type:"single",topic:"Airborne",
   prompt:"A patient is suspected of having active TB. What isolation is required?",
   options:["Droplet","Contact","Airborne + negative pressure","Standard only"],
   ans:2, rat:"TB requires airborne precautions and negative pressure."},

  {id:33,type:"single",topic:"Sterile Field",
   prompt:"During sterile dressing change, a sterile glove touches the bed sheet. Best action?",
   options:["Continue; sheets are clean","Cover glove with sterile gauze","Replace contaminated glove and re-establish sterile technique","Ignore if no drainage"],
   ans:2, rat:"Contamination breaks sterility; replace and continue using aseptic technique."},

  {id:34,type:"single",topic:"PPE Removal",
   prompt:"Most common PPE removal sequence (follow facility policy):",
   options:["Mask → gown → gloves → goggles","Gloves → gown → goggles/face shield → mask","Gown → gloves → mask → goggles","Goggles → mask → gown → gloves"],
   ans:1, rat:"Common sequence: gloves, gown, goggles/face shield, mask."},

  {id:35,type:"single",topic:"Sharps",
   prompt:"After giving an injection, the nurse should:",
   options:["Recap with two hands","Recap with one-hand scoop technique routinely","Activate safety device and discard immediately in sharps container","Carry needle to med room before discarding"],
   ans:2, rat:"Do not recap; dispose immediately in sharps container."},

  {id:36,type:"single",topic:"UTI Prevention",
   prompt:"Best action to reduce CAUTI risk in a patient with a Foley catheter:",
   options:["Disconnect tubing to empty faster","Maintain closed system and secure catheter","Keep drainage bag on bed","Irrigate every shift"],
   ans:1, rat:"Closed system + securement + dependent drainage reduce CAUTI."},

  // ---------- Mobility, safety, skin/wounds (10) ----------
  {id:37,type:"single",topic:"Falls",
   prompt:"During ambulation, the patient becomes dizzy and starts to fall. Best immediate action?",
   options:["Hold them upright","Lower them to the floor and protect head","Leave to get help","Pull back to bed quickly"],
   ans:1, rat:"Guide to floor, protect head, call for help, then assess."},

  {id:38,type:"single",topic:"Restraints",
   prompt:"A confused patient keeps pulling at lines. Which is best initial approach?",
   options:["Apply wrist restraints immediately","Use least restrictive measures: reorientation, frequent rounding, move items within reach, alarms/sitter per policy","Raise all 4 side rails","Place call light out of reach"],
   ans:1, rat:"Least restrictive first; restraints last resort with policy requirements."},

  {id:39,type:"single",topic:"Pressure Injury Staging",
   prompt:"Nonblanchable redness over a bony prominence with intact skin is:",
   options:["Stage 1","Stage 2","Stage 3","Stage 4"],
   ans:0, rat:"Stage 1 = intact skin with nonblanchable erythema."},

  {id:40,type:"single",topic:"Pressure Injury Staging",
   prompt:"A shallow open ulcer with a pink/red wound bed and no slough is most consistent with:",
   options:["Stage 1","Stage 2","Stage 3","Unstageable"],
   ans:1, rat:"Stage 2 = partial-thickness loss; shallow open ulcer or blister."},

  {id:41,type:"sata",topic:"Pressure Injury Prevention",
   prompt:"Which interventions help prevent pressure injuries? (Select all that apply.)",
   options:[
     "Turn/reposition on schedule",
     "Float heels",
     "Massage reddened areas",
     "Manage moisture/incontinence with barrier",
     "Reduce shear by keeping HOB as low as tolerated"
   ],
   ans:[0,1,3,4], rat:"Reposition, float heels, manage moisture, reduce shear. Do not massage reddened areas."},

  {id:42,type:"single",topic:"Wound Drainage",
   prompt:"You find a fresh surgical dressing saturated with bright-red drainage. Best action?",
   options:[
     "Remove dressing to inspect incision",
     "Mark drainage outline/time, assess vitals, reinforce dressing, notify provider if increasing/unstable",
     "Ignore; expected after surgery",
     "Change to a smaller dressing"
   ],
   ans:1, rat:"Assess stability, mark/monitor bleeding, reinforce, escalate if worsening."},

  {id:43,type:"single",topic:"Neurovascular",
   prompt:"A patient in a cast reports escalating pain unrelieved by medication and new numbness/tingling. Priority action?",
   options:[
     "Document as expected post-cast pain",
     "Reposition and reassess in 2 hours",
     "Notify provider immediately for possible neurovascular compromise",
     "Apply heat over the cast"
   ],
   ans:2, rat:"Possible compartment syndrome/neurovascular compromise requires urgent evaluation."},

  {id:44,type:"single",topic:"Safe Transfers",
   prompt:"Before transferring a weak patient from bed to chair, the nurse should first:",
   options:["Tell the patient to stand quickly","Lock bed and chair/wheelchair and apply non-skid footwear","Pull patient by arms to standing","Place chair far away for exercise"],
   ans:1, rat:"Safety setup reduces falls and injury."},

  {id:45,type:"single",topic:"Fire Safety",
   prompt:"A fire starts in a patient room. The nurse’s first action follows RACE. What does RACE stand for?",
   options:["Rescue, Alarm, Confine, Extinguish/Evacuate","Run, Alert, Call, Exit","Remove, Assess, Contain, Enter","Restrain, Alarm, Cool, Evacuate"],
   ans:0, rat:"RACE: Rescue, Alarm, Confine/Contain, Extinguish/Evacuate."},

  {id:46,type:"single",topic:"Oxygen Safety",
   prompt:"Which action is appropriate for a patient receiving oxygen therapy?",
   options:["Allow smoking if oxygen is turned down","Use petroleum-based lotion on lips","Post “Oxygen in Use” signage and keep ignition sources away","Store oxygen tanks near heat source"],
   ans:2, rat:"Oxygen supports combustion; keep ignition sources away and follow safety signage."},

  // ---------- Elimination & GI (4) ----------
  {id:47,type:"single",topic:"Constipation",
   prompt:"A patient on iron supplements reports black stools. Best nursing action?",
   options:["Treat as GI bleed immediately without assessment","Assess for additional bleeding signs and review meds; educate that iron can darken stool","Stop iron without provider input","Administer laxative immediately"],
   ans:1, rat:"Iron can darken stools; assess for true bleeding signs (tarry, foul, hypotension, etc.) and educate appropriately."},

  {id:48,type:"single",topic:"Urinary Retention",
   prompt:"A post-op patient hasn’t voided in 9 hours and reports suprapubic fullness. Best first action?",
   options:["Restrict fluids","Bladder scan/assess for retention per protocol","Give diuretic","Document and reassess next shift"],
   ans:1, rat:"Assess objectively (bladder scan) and follow retention protocol."},

  {id:49,type:"single",topic:"Diarrhea Care",
   prompt:"A patient with frequent watery stools is at greatest risk for:",
   options:["Fluid volume excess","Skin breakdown and fluid/electrolyte loss","Hypercalcemia","Increased oxygenation"],
   ans:1, rat:"Diarrhea increases risk for dehydration, electrolyte loss, and skin breakdown."},

  {id:50,type:"single",topic:"NG Tube",
   prompt:"A patient with an NG tube has sudden coughing and difficulty breathing. Best action?",
   options:["Increase suction","Stop feeding/suction and assess; verify tube placement per policy; notify provider/rapid response as indicated",
            "Give oral water","Ignore; expected with NG tubes"],
   ans:1, rat:"Possible displacement/aspiration risk: stop, assess ABCs, verify placement, escalate per policy."},

  // ---------- Nutrition, diabetes, teaching (6) ----------
  {id:51,type:"single",topic:"Malnutrition",
   prompt:"Which finding most strongly suggests malnutrition risk in an adult inpatient?",
   options:["BMI 29","Unintentional weight loss over the past month","HDL 70","Dry skin only"],
   ans:1, rat:"Unintentional weight loss is a key indicator."},

  {id:52,type:"single",topic:"Hypoglycemia",
   prompt:"A conscious patient is sweaty, shaky, and confused; glucose is 54 mg/dL. Best first action?",
   options:["Give 15 g fast-acting carbohydrate and recheck in 15 minutes","Administer long-acting insulin","Encourage exercise","Give sugar-free gelatin"],
   ans:0, rat:"Treat hypoglycemia with fast carbs; recheck per protocol (15-15 rule)."},

  {id:53,type:"single",topic:"Tube Feeding Meds",
   prompt:"Best practice when giving multiple medications via feeding tube:",
   options:["Mix all meds together to save time","Flush with water between each medication","Give meds with formula to “improve absorption”","Skip flushing if patient is fluid-restricted"],
   ans:1, rat:"Flush between meds prevents clogging and reduces interactions (use ordered flush volumes/policy)."},

  {id:54,type:"single",topic:"Patient Teaching",
   prompt:"Best way to confirm a patient learned how to use a walker safely:",
   options:["Ask “Do you understand?”","Have the patient demonstrate and teach-back key safety steps","Provide a brochure only","Ask family to confirm the patient understands"],
   ans:1, rat:"Return demonstration + teach-back confirm learning."},

  {id:55,type:"single",topic:"Readiness to Learn",
   prompt:"A patient is scheduled for discharge teaching but reports severe pain and can’t focus. Best action?",
   options:["Proceed; discharge is today","Address pain/comfort first and reschedule teaching when patient can attend","Teach only the hardest content","Have them sign the teaching form"],
   ans:1, rat:"Learning requires readiness; treat barriers (pain) first."},

  {id:56,type:"single",topic:"Health Literacy",
   prompt:"Which teaching approach best supports patients with limited health literacy?",
   options:["Use medical jargon to be precise","Use small print to fit more info","Use plain language and confirm understanding with teach-back","Avoid pictures entirely"],
   ans:2, rat:"Plain language + teach-back improves comprehension and retention."},

  // ---------- Ethics, consent, cultural care, EOL (4) ----------
  {id:57,type:"single",topic:"Autonomy",
   prompt:"A competent patient refuses a recommended procedure after risks/benefits are explained. The nurse should:",
   options:["Pressure the patient to agree","Respect the decision and notify provider of refusal per policy","Ask family to override the patient","Proceed if the provider ordered it"],
   ans:1, rat:"Competent patients have the right to refuse; notify provider and document objectively."},

  {id:58,type:"single",topic:"Informed Consent",
   prompt:"A patient says, “I don’t understand what they’re going to do,” right before signing consent. Best nursing action?",
   options:["Witness signature anyway","Explain the procedure in detail and obtain signature","Stop and notify provider to re-explain before signing","Tell the patient it’s routine and to sign"],
   ans:2, rat:"Provider obtains informed consent; nurse stops and requests re-explanation if understanding is lacking."},

  {id:59,type:"single",topic:"Interpreter",
   prompt:"A patient speaks limited English and nods during teaching but looks confused. Best action?",
   options:["Speak louder and slower","Use a family member as interpreter for complex teaching","Request a qualified medical interpreter","Skip teaching and give written English instructions"],
   ans:2, rat:"Qualified interpreters reduce errors and improve safety/understanding."},

  {id:60,type:"single",topic:"End-of-Life",
   prompt:"A hospice patient requests more frequent pain medication. Family is worried about addiction. Best nursing response?",
   options:["“We should avoid opioids to prevent addiction.”","“Comfort is the priority at end-of-life; we will treat pain safely.”","“We can only medicate if the family agrees.”","“Pain meds should be stopped to prevent sedation.”"],
   ans:1, rat:"End-of-life care prioritizes comfort; manage pain appropriately and educate family."},
];

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function arraysEqual(a,b){ if(a.length!==b.length) return false; for(let i=0;i<a.length;i++) if(a[i]!==b[i]) return false; return true; }
function esc(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
                  .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

const state = { order: [], idx: 0, answers: new Map(), timerOn:false, timerSec:0, tick:null, startTs:null };

function renderStart(){
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>Fundamentals Final Review — Unique Scenario Exam (60)</h1>
    <div class="muted">Fresh question set • MCQ + SATA + math • Shuffles each run • No duplicates inside exam</div>
    <div class="hr"></div>
    <div class="row">
      <button class="btn good" id="startShuf">Start (Shuffled)</button>
      <button class="btn secondary" id="startTimed">Start Timed (75 min)</button>
      <span class="pill" id="timer"></span>
    </div>
    <div class="hr"></div>
    <div class="tiny">Numeric: enter numbers only. SATA is all-or-nothing (typical scoring).</div>
  `;
  document.getElementById("startShuf").onclick = ()=>startExam(true,false,75);
  document.getElementById("startTimed").onclick= ()=>startExam(true,true,75);
}

function startExam(shuffleOrder=true, timed=false, minutes=75){
  // exactly once each id 1..60
  state.order = QUESTIONS.map(q=>q.id);
  if(shuffleOrder) state.order = shuffle(state.order);
  state.idx = 0;
  state.answers.clear();
  state.startTs = Date.now();

  state.timerOn = timed;
  state.timerSec = minutes*60;
  if(state.tick) clearInterval(state.tick);
  if(timed){
    state.tick = setInterval(()=>{
      state.timerSec--;
      if(state.timerSec<=0){
        clearInterval(state.tick);
        renderResults();
      } else renderTimer();
    },1000);
  }
  renderQuestion();
}

function renderTimer(){
  const el = document.getElementById("timer");
  if(!el) return;
  if(!state.timerOn){ el.textContent=""; return; }
  const m = Math.floor(state.timerSec/60);
  const s = state.timerSec%60;
  el.textContent = `Time: ${m}:${String(s).padStart(2,"0")}`;
}

function getQ(){
  const id = state.order[state.idx];
  return QUESTIONS.find(q=>q.id===id);
}

function formatCorrect(q){
  if(q.type==="single") return q.options[q.ans];
  if(q.type==="sata") return q.ans.map(i=>q.options[i]).join("; ");
  if(q.type==="numeric") return String(q.ansN.v);
  return "";
}

function grade(q){
  if(q.type==="single"){
    const c = document.querySelector('input[type="radio"][name="opt"]:checked');
    const user = c ? Number(c.value) : null;
    return { user, correct: user===q.ans, correctAnswer:q.ans };
  }
  if(q.type==="sata"){
    const picked = Array.from(document.querySelectorAll('input[type="checkbox"][name="opt"]:checked'))
      .map(x=>Number(x.value)).sort((a,b)=>a-b);
    const key = q.ans.slice().sort((a,b)=>a-b);
    return { user:picked, correct: arraysEqual(picked,key), correctAnswer:key };
  }
  if(q.type==="numeric"){
    const raw = document.getElementById("numInput").value.trim();
    const v = Number(raw);
    const key = q.ansN.v;
    const tol = q.ansN.t ?? 0;
    const correct = Number.isFinite(v) && Math.abs(v-key) <= tol;
    return { user: raw, correct, correctAnswer: key };
  }
}

function lockInputs(q){
  if(q.type==="numeric") document.getElementById("numInput").disabled = true;
  else document.querySelectorAll('input[name="opt"]').forEach(x=>x.disabled=true);
}
function restore(q, user){
  if(q.type==="numeric"){
    document.getElementById("numInput").value = user ?? "";
  } else if(q.type==="single"){
    const el = document.querySelector(`input[type="radio"][name="opt"][value="${user}"]`);
    if(el) el.checked = true;
  } else {
    (user||[]).forEach(i=>{
      const el = document.querySelector(`input[type="checkbox"][name="opt"][value="${i}"]`);
      if(el) el.checked = true;
    });
  }
}

function renderQuestion(){
  const q = getQ();
  const app = document.getElementById("app");
  const progress = `${state.idx+1} / ${state.order.length}`;

  let html = `
    <div class="row" style="justify-content:space-between;">
      <div class="row">
        <span class="pill">Question ${progress}</span>
        <span class="pill">${esc(q.topic)}</span>
        <span class="pill" id="timer"></span>
      </div>
      <button class="btn secondary" id="endBtn">End & Score</button>
    </div>
    <div class="qtext"><strong>${esc(q.prompt)}</strong></div>
  `;

  if(q.type==="single" || q.type==="sata"){
    const t = q.type==="single" ? "radio" : "checkbox";
    html += `<div class="opts" id="opts">`;
    q.options.forEach((opt,i)=>{
      html += `<label class="opt"><input type="${t}" name="opt" value="${i}"><div>${esc(opt)}</div></label>`;
    });
    html += `</div>`;
  } else {
    html += `
      <div class="row">
        <input class="inputbox mono" id="numInput" inputmode="decimal" placeholder="Enter number only (no units)" />
      </div>
      <div class="tiny" style="margin-top:6px;">Follow rounding instructions in the stem.</div>
    `;
  }

  html += `
    <div class="hr"></div>
    <div class="row" style="justify-content:space-between;">
      <button class="btn secondary" id="prevBtn" ${state.idx===0?"disabled":""}>Back</button>
      <div class="row">
        <button class="btn" id="checkBtn" disabled>Check</button>
        <button class="btn good" id="nextBtn" disabled>Next</button>
      </div>
    </div>
    <div id="fbSlot"></div>
  `;

  app.innerHTML = html;
  renderTimer();

  document.getElementById("endBtn").onclick = ()=>renderResults();
  document.getElementById("prevBtn").onclick = ()=>{ state.idx--; renderQuestion(); };

  const checkBtn = document.getElementById("checkBtn");
  const nextBtn  = document.getElementById("nextBtn");

  function enableCheck(){
    let answered = false;
    if(q.type==="single") answered = !!document.querySelector('input[type="radio"][name="opt"]:checked');
    else if(q.type==="sata") answered = document.querySelectorAll('input[type="checkbox"][name="opt"]:checked').length>0;
    else answered = document.getElementById("numInput").value.trim().length>0;
    checkBtn.disabled = !answered;
  }

  if(q.type==="numeric") document.getElementById("numInput").addEventListener("input", enableCheck);
  else document.getElementById("opts").addEventListener("change", enableCheck);

  checkBtn.onclick = ()=>{
    const res = grade(q);
    state.answers.set(q.id, res);
    showFeedback(q, res);
    lockInputs(q);
    checkBtn.disabled = true;
    nextBtn.disabled = false;
  };

  nextBtn.onclick = ()=>{
    if(state.idx < state.order.length-1){ state.idx++; renderQuestion(); }
    else renderResults();
  };

  const existing = state.answers.get(q.id);
  if(existing){
    restore(q, existing.user);
    lockInputs(q);
    showFeedback(q, existing);
    checkBtn.disabled = true;
    nextBtn.disabled = false;
  }
}

function showFeedback(q, res){
  const slot = document.getElementById("fbSlot");
  const cls = res.correct ? "good" : "bad";
  let correctLine = "";
  if(!res.correct){
    correctLine = `<div class="tiny"><span class="tag">Correct</span>${esc(formatCorrect(q))}</div>`;
  }
  slot.innerHTML = `
    <div class="feedback ${cls}">
      <div><strong>${res.correct ? "Correct" : "Incorrect"}</strong></div>
      ${correctLine}
      <div class="tiny" style="margin-top:6px;"><span class="tag">Rationale</span>${esc(q.rat)}</div>
    </div>
  `;
}

function renderResults(){
  if(state.tick) clearInterval(state.tick);

  const total = state.order.length;
  let correct = 0;
  const missed = [];
  state.order.forEach(id=>{
    const res = state.answers.get(id);
    if(res && res.correct) correct++;
    else missed.push(id);
  });

  const pct = Math.round((correct/total)*100);
  const minutesUsed = Math.round((Date.now()-state.startTs)/60000);

  const missedPreview = missed.slice(0,12).map(id=>{
    const q = QUESTIONS.find(x=>x.id===id);
    return `<li><span class="tag">${esc(q.topic)}</span> ${esc(q.prompt)}</li>`;
  }).join("");

  document.getElementById("app").innerHTML = `
    <h1>Results — Unique Scenario Exam</h1>
    <div class="row">
      <span class="pill">Score: <strong>${correct}/${total}</strong> (${pct}%)</span>
      <span class="pill">Missed: ${missed.length}</span>
      <span class="pill">Time used: ${minutesUsed} min</span>
    </div>
    <div class="hr"></div>
    <div class="row">
      <button class="btn good" id="restart">Restart (New Shuffle)</button>
      <button class="btn secondary" id="home">Home</button>
    </div>
    <div class="hr"></div>
    <div class="tiny">No “retest missed” button (it repeats questions). If you want a review page listing missed rationales without re-asking, say so.</div>
    <div class="hr"></div>
    <div class="tiny"><strong>Missed question preview (first 12):</strong></div>
    <ol class="tiny">${missedPreview || "<li>None — clean sweep.</li>"}</ol>
  `;

  document.getElementById("restart").onclick = ()=>startExam(true,false,75);
  document.getElementById("home").onclick = ()=>renderStart();
}

renderStart();
</script>
</body>
</html>
