<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Fundamentals of Care — Scenario Mastery Exam (60)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0b1020; color: #e9eefc; }
    .wrap { max-width: 1050px; margin: 0 auto; padding: 16px; }
    .card { background:#121a33; border:1px solid #22305e; border-radius:14px; padding:14px; box-shadow:0 10px 30px rgba(0,0,0,.25); }
    h1 { margin: 0 0 6px; font-size: 18px; }
    .muted { color:#a9b6e8; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .pill { background:#0f1730; border:1px solid #22305e; padding:6px 10px; border-radius:999px; font-size:12px; color:#c7d2ff; }
    .btn { appearance:none; border:1px solid #2a3a76; background:#1a2550; color:#e9eefc; padding:10px 12px; border-radius:10px; cursor:pointer; font-weight:650; }
    .btn.secondary { background:#0f1730; }
    .btn.good { border-color:#2a7a4f; background:#153a2b; }
    .btn.bad { border-color:#8a2d2d; background:#3a1515; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .hr { height:1px; background:#22305e; margin:12px 0; }
    .qtext { font-size: 16px; line-height: 1.35; margin: 10px 0; }
    .stem { color:#cfe0ff; margin-top:6px; }
    .opts { display:grid; gap:10px; margin-top:10px; }
    label.opt { display:flex; gap:10px; align-items:flex-start; background:#0f1730; border:1px solid #22305e; border-radius:12px; padding:10px 12px; cursor:pointer; }
    label.opt:hover { border-color:#3a54b0; }
    input[type="radio"], input[type="checkbox"] { margin-top:2px; transform: scale(1.15); }
    .inputbox { width: 280px; max-width: 100%; background:#0f1730; border:1px solid #22305e; border-radius:10px; color:#e9eefc; padding:10px 12px; font-size:16px; }
    .feedback { margin-top:12px; padding:12px; border-radius:12px; border:1px solid #22305e; background:#0f1730; }
    .feedback.good { border-color:#2a7a4f; }
    .feedback.bad { border-color:#8a2d2d; }
    .tag { display:inline-block; font-size:11px; padding:3px 8px; border-radius:999px; border:1px solid #22305e; color:#c7d2ff; margin-right:6px; }
    .tiny { font-size:12px; color:#a9b6e8; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app"></div>
    <div class="tiny" style="margin-top:12px;">
      Scenario focus: ABCs/priority, safety, infection control, fluids/electrolytes, oxygenation, pain/sleep, teaching, ethics/EOL, meds & dosage calculations.
    </div>
  </div>

<script>
/* =========================
   Scenario Mastery Exam (60)
   Types: single | sata | numeric
   Numeric checking: exact or tolerance
   ========================= */

const QUESTIONS = [
  // ===== Medication calculations / safety (scenario-based) =====
  {
    id: 1, type:"numeric", topic:"Dosage Calc",
    prompt:"A 52-year-old patient (220 lb) is admitted with a new DVT. Provider orders enoxaparin 1 mg/kg subcut every 12 hr. The nurse confirms weight is current. Round to the whole number. What is the single dose (mg)?",
    ansN:{v:100,t:0},
    rat:"Convert lb→kg: 220 ÷ 2.2 = 100 kg. Dose: 1 mg/kg × 100 kg = 100 mg per dose."
  },
  {
    id: 2, type:"numeric", topic:"Dosage Calc",
    prompt:"A post-op patient is ordered cefazolin 0.3 g IM now. The vial is reconstituted to 250 mg/mL. Round to the nearest tenth. How many mL will the nurse administer?",
    ansN:{v:1.2,t:0.05},
    rat:"0.3 g = 300 mg. 300 ÷ 250 = 1.2 mL."
  },
  {
    id: 3, type:"numeric", topic:"Dosage Calc",
    prompt:"A patient with cellulitis is ordered clindamycin 400 mg IM. Available concentration is 155 mg/mL. Round to the nearest tenth. How many mL should be drawn up?",
    ansN:{v:2.6,t:0.05},
    rat:"400 ÷ 155 = 2.58… → 2.6 mL."
  },
  {
    id: 4, type:"single", topic:"Equipment",
    prompt:"You prepared a 2.6 mL IM dose. Which syringe provides the most accurate measurement?",
    options:["3 mL syringe","5 mL syringe","10 mL syringe","Tuberculin (1 mL) syringe"],
    ans:0,
    rat:"Use the smallest syringe that can safely contain the dose for the most accurate markings—3 mL is best for 2.6 mL."
  },
  {
    id: 5, type:"sata", topic:"Medication Safety",
    prompt:"A nurse is preparing morning meds. Which actions reflect safe medication practice? (Select all that apply.)",
    options:[
      "Compare the medication label with the MAR when removing it from storage.",
      "Use two identifiers (name and DOB/MRN) before administration.",
      "Verify the medication by pill shape/size if the label looks different.",
      "Compare the medication label with the MAR again at the bedside.",
      "Document the medication as given before entering the room to save time."
    ],
    ans:[0,1,3],
    rat:"Three checks + two identifiers reduce error. Pill appearance is unreliable. Chart after administration."
  },
  {
    id: 6, type:"single", topic:"Allergic Reaction / Priority",
    prompt:"A patient received a first dose of a new antibiotic 10 minutes ago. Which assessment finding requires immediate action?",
    options:[
      "Nausea and mild abdominal discomfort",
      "Itching on arms without rash",
      "New wheezing with facial swelling",
      "Headache rated 3/10"
    ],
    ans:2,
    rat:"Wheezing + facial swelling suggests anaphylaxis/airway compromise → ABC priority."
  },

  // ===== Oxygenation / respiratory scenarios =====
  {
    id: 7, type:"sata", topic:"Early Hypoxia",
    prompt:"A COPD patient becomes restless during ambulation back from the bathroom. Which findings are consistent with early hypoxia? (Select all that apply.)",
    options:[
      "Irritability and agitation",
      "Cyanosis of lips and nailbeds",
      "Respiratory rate increased from 16 to 26",
      "New confusion (asks where they are)",
      "Heart rate decreased from 84 to 58"
    ],
    ans:[0,2,3],
    rat:"Early hypoxia: restlessness/irritability, confusion, tachypnea (often tachycardia). Cyanosis and bradycardia are late."
  },
  {
    id: 8, type:"single", topic:"Oxygen Devices",
    prompt:"A patient requires a controlled, precise FiO₂ due to CO₂ retention risk. Which device is most appropriate?",
    options:["Nasal cannula","Venturi mask","Simple face mask","Nonrebreather mask"],
    ans:1,
    rat:"Venturi mask delivers the most precise/controlled FiO₂."
  },
  {
    id: 9, type:"single", topic:"Respiratory Mechanics",
    prompt:"When a patient takes a normal breath in, which physiological change allows air to enter the lungs?",
    options:[
      "Diaphragm contracts, thoracic volume increases, intrapulmonary pressure decreases",
      "Diaphragm relaxes, thoracic volume decreases, intrapulmonary pressure decreases",
      "Ribs move inward, thoracic volume decreases, pressure decreases",
      "Intercostals relax, thoracic volume increases, pressure increases"
    ],
    ans:0,
    rat:"Inhalation: diaphragm contracts down → volume ↑ → pressure ↓ → air flows in."
  },
  {
    id:10, type:"single", topic:"Incentive Spirometer Teaching",
    prompt:"A post-op patient demonstrates incentive spirometer use. Which statement indicates incorrect technique?",
    options:[
      "“I exhale normally first, then seal my lips on the mouthpiece.”",
      "“I inhale slowly to raise the ball to the target mark.”",
      "“I blow into it hard to make the ball rise.”",
      "“I hold my breath for a few seconds, then exhale.”"
    ],
    ans:2,
    rat:"Incentive spirometry requires slow deep inhalation, not forceful exhalation."
  },

  // ===== Fluids / electrolytes scenarios =====
  {
    id:11, type:"sata", topic:"Fluid Volume Deficit",
    prompt:"A patient with vomiting and diarrhea is weak and dizzy when standing. Which findings support fluid volume deficit? (Select all that apply.)",
    options:[
      "Decreased urine output",
      "Distended neck veins",
      "Dry mucous membranes",
      "Orthostatic hypotension/syncope",
      "Crackles in the lung bases"
    ],
    ans:[0,2,3],
    rat:"FVD: low UO, dry mucosa, orthostatic hypotension. JVD/crackles suggest excess."
  },
  {
    id:12, type:"sata", topic:"Fluid Volume Excess",
    prompt:"A patient with heart failure reports worsening shortness of breath. Which findings suggest fluid volume excess? (Select all that apply.)",
    options:[
      "Weight gain in 48 hours",
      "Crackles on auscultation",
      "Flat neck veins",
      "Edema in ankles",
      "Dry mucous membranes"
    ],
    ans:[0,1,3],
    rat:"FVE: weight gain, crackles, edema, JVD, hypertension. Flat neck veins/dry mucosa suggests deficit."
  },
  {
    id:13, type:"single", topic:"Electrolytes",
    prompt:"A patient has tingling around the mouth and muscle cramps after thyroid surgery. Which imbalance is most likely?",
    options:["Hypokalemia","Hypocalcemia","Hypernatremia","Hypermagnesemia"],
    ans:1,
    rat:"Low calcium causes neuromuscular excitability (paresthesias, cramps/tetany)."
  },
  {
    id:14, type:"single", topic:"Electrolytes",
    prompt:"A patient with kidney failure has ECG changes with peaked T waves. Which imbalance is most likely?",
    options:["Hyperkalemia","Hypokalemia","Hyponatremia","Hypocalcemia"],
    ans:0,
    rat:"Peaked T waves are classic for hyperkalemia."
  },

  // ===== Documentation scenarios =====
  {
    id:15, type:"single", topic:"Documentation",
    prompt:"A nurse observes SOB after ambulation. Which documentation is best?",
    options:[
      "“Patient complained of SOB after walking.”",
      "“Patient is hypoxic after walking to bathroom.”",
      "“Dyspnea noted after ambulating 15 feet; RR 28; speaking in 2–3 word sentences.”",
      "“Patient became anxious and exaggerated symptoms.”"
    ],
    ans:2,
    rat:"Best charting is objective, specific, and measurable. Avoid diagnoses/judgment."
  },
  {
    id:16, type:"single", topic:"Documentation",
    prompt:"Which note is most legally defensible?",
    options:[
      "“Patient is rude and refusing care.”",
      "“Patient refused dressing change; stated ‘I’m in too much pain.’ Education provided.”",
      "“Patient is noncompliant.”",
      "“Patient is hypoxemic and anxious.”"
    ],
    ans:1,
    rat:"Use objective facts and direct quotes. Avoid labels like noncompliant/rude and diagnoses without data."
  },

  // ===== Delegation / safety scenarios =====
  {
    id:17, type:"single", topic:"Delegation",
    prompt:"An RN is caring for 4 patients. Which task is appropriate to delegate to UAP?",
    options:[
      "Assess a new onset of chest pain",
      "Teach an incentive spirometer to a post-op patient",
      "Obtain routine vital signs on a stable patient",
      "Evaluate pain response 30 minutes after IV opioid"
    ],
    ans:2,
    rat:"UAP: routine vitals on stable patients. RN keeps assessment/teaching/evaluation."
  },
  {
    id:18, type:"single", topic:"Delegation",
    prompt:"Which task should the RN NOT delegate to an LPN/LVN (typical scope/policy dependent)?",
    options:[
      "Administer routine oral medications",
      "Reinforce teaching from a standard plan",
      "Initial assessment of a newly admitted patient",
      "Perform a sterile dressing change (if trained)"
    ],
    ans:2,
    rat:"Initial assessment and care planning are RN responsibilities."
  },

  // ===== Infection control scenarios =====
  {
    id:19, type:"single", topic:"Infection Control",
    prompt:"A patient with C. difficile requires assistance to the bathroom. Which is the priority infection-control action?",
    options:[
      "Use alcohol-based sanitizer after removing gloves",
      "Wash hands with soap and water after care",
      "Wear an N95 respirator",
      "Place the patient in a negative-pressure room"
    ],
    ans:1,
    rat:"C. diff spores require soap and water; sanitizer is not sufficient."
  },
  {
    id:20, type:"single", topic:"PPE",
    prompt:"After providing care, which PPE removal sequence is most appropriate (common standard)?",
    options:[
      "Mask → gown → gloves → goggles",
      "Gloves → gown → goggles/face shield → mask",
      "Gown → mask → gloves → goggles",
      "Goggles → gloves → gown → mask"
    ],
    ans:1,
    rat:"Common sequence: gloves, gown, goggles/face shield, mask (follow facility policy)."
  },

  // ===== Pain / sleep / comfort scenarios =====
  {
    id:21, type:"single", topic:"Pain Assessment",
    prompt:"A patient grimaces but states pain is 2/10 and refuses medication. Best nursing action?",
    options:[
      "Document 2/10 and no further action needed",
      "Administer analgesic anyway because grimacing indicates severe pain",
      "Reassess with a focused pain assessment and ask patient’s comfort goal",
      "Notify provider immediately"
    ],
    ans:2,
    rat:"Pain is subjective; validate patient report and reassess fully (location/quality/function/goal)."
  },
  {
    id:22, type:"single", topic:"Sleep",
    prompt:"A hospitalized patient reports poor sleep. Which nursing intervention is most appropriate first?",
    options:[
      "Schedule all care at midnight to reduce awakenings later",
      "Cluster care to minimize nighttime interruptions",
      "Encourage daytime napping for 4–5 hours",
      "Increase caffeine with meals"
    ],
    ans:1,
    rat:"Cluster care reduces interruptions and supports restorative sleep."
  },

  // ===== Teaching scenarios =====
  {
    id:23, type:"single", topic:"Patient Teaching",
    prompt:"A patient is learning how to self-inject insulin. Which method best confirms learning?",
    options:[
      "Ask “Do you understand?”",
      "Have patient read the handout aloud",
      "Teach-back with return demonstration",
      "Ask family member if they understand"
    ],
    ans:2,
    rat:"Return demonstration is best for skill validation."
  },
  {
    id:24, type:"single", topic:"Teaching Readiness",
    prompt:"A patient is scheduled for discharge teaching but rates pain 9/10 and appears distracted. Best action?",
    options:[
      "Proceed quickly because discharge is today",
      "Postpone teaching until pain is better controlled",
      "Teach only the most complex topics first",
      "Ask the patient to sign the teaching form"
    ],
    ans:1,
    rat:"Address barriers to learning first (pain, readiness, environment)."
  },

  // ===== Ethics/EOL/Culture scenarios =====
  {
    id:25, type:"single", topic:"Ethics",
    prompt:"A competent adult refuses a blood transfusion for religious reasons. The provider explains risks. Best nursing response reflects which principle?",
    options:["Beneficence","Autonomy","Justice","Nonmaleficence"],
    ans:1,
    rat:"Autonomy: competent patient’s right to refuse treatment."
  },
  {
    id:26, type:"single", topic:"Informed Consent",
    prompt:"Right before signing consent, a patient says, “I don’t understand what this procedure is for.” What should the nurse do?",
    options:[
      "Witness the signature and document the patient’s statement",
      "Explain risks/benefits and obtain signature",
      "Stop the process and notify the provider to re-explain",
      "Tell the patient to sign and ask later"
    ],
    ans:2,
    rat:"Provider obtains informed consent. Nurse stops and notifies provider if patient lacks understanding."
  },
  {
    id:27, type:"single", topic:"Hospice/Palliative",
    prompt:"A patient with end-stage disease is enrolling in hospice. Which statement is accurate?",
    options:[
      "Hospice means all medications must stop immediately",
      "Hospice focuses on comfort and quality of life",
      "Hospice is only for patients who are hospitalized",
      "Hospice is the same as curative treatment"
    ],
    ans:1,
    rat:"Hospice prioritizes comfort and quality of life."
  },
  {
    id:28, type:"single", topic:"Cultural/Spiritual Care",
    prompt:"A family requests a brief religious ritual before postmortem care begins. Best nursing action?",
    options:[
      "Proceed with postmortem care immediately to avoid delay",
      "Accommodate the ritual when possible and provide privacy",
      "Explain that rituals are not allowed in hospitals",
      "Ask security to remove the family"
    ],
    ans:1,
    rat:"Provide culturally/spiritually competent care when possible within policy and safety."
  },

  // ===== Routes / mucosal meds scenarios =====
  {
    id:29, type:"single", topic:"Ear Drops",
    prompt:"The nurse is teaching ear drop administration for an adult. Which instruction is correct?",
    options:[
      "Pull the pinna down and back to straighten the canal",
      "Pull the pinna up and back to straighten the canal",
      "Insert the dropper tip into the canal to prevent leaking",
      "Pack cotton deep into the canal after drops"
    ],
    ans:1,
    rat:"Adult ear: pull pinna up and back. Do not contaminate dropper or pack cotton deep."
  },
  {
    id:30, type:"sata", topic:"Oral Cavity Routes",
    prompt:"Which routes administer medication in the mouth/oral cavity? (Select all that apply.)",
    options:["Sublingual","Buccal","Parenteral","Topical (skin)","Rectal"],
    ans:[0,1],
    rat:"Sublingual and buccal are oral cavity mucosal routes."
  },

  // ===== Elimination / CAUTI scenario =====
  {
    id:31, type:"single", topic:"CAUTI Prevention",
    prompt:"A patient has a Foley catheter. Which nursing action best reduces risk of CAUTI?",
    options:[
      "Disconnect tubing daily to rinse it out",
      "Maintain a closed system and secure catheter to thigh",
      "Keep drainage bag on the bed for easy emptying",
      "Irrigate the catheter every shift"
    ],
    ans:1,
    rat:"Closed system + securement + dependent drainage decreases CAUTI risk."
  },

  // ===== Wounds / pressure injury scenarios =====
  {
    id:32, type:"single", topic:"Pressure Injury Staging",
    prompt:"A patient has a shallow open area on the sacrum with a pink wound bed and no slough. This is most consistent with:",
    options:["Stage 1","Stage 2","Stage 3","Stage 4"],
    ans:1,
    rat:"Stage 2 = partial-thickness skin loss; open shallow ulcer or blister."
  },
  {
    id:33, type:"sata", topic:"Pressure Injury Prevention",
    prompt:"An immobile patient is at high risk for pressure injury. Which interventions are appropriate? (Select all that apply.)",
    options:[
      "Turn/reposition on a scheduled basis",
      "Keep head of bed as low as tolerated to reduce shear",
      "Massage reddened bony prominences vigorously",
      "Use moisture barrier and manage incontinence",
      "Float heels off the bed"
    ],
    ans:[0,1,3,4],
    rat:"Reposition, reduce shear, manage moisture, float heels. Do not massage reddened areas."
  },

  // ===== Mobility / fall scenario =====
  {
    id:34, type:"single", topic:"Falls",
    prompt:"While ambulating, a patient suddenly becomes dizzy and begins to fall. What is the nurse’s best immediate action?",
    options:[
      "Try to hold the patient upright to prevent falling",
      "Lower the patient to the floor and protect the head",
      "Leave to get help while the patient stands still",
      "Pull the patient back to bed quickly"
    ],
    ans:1,
    rat:"Guide to floor, protect head, then call for assistance and assess."
  },

  // ===== Nutrition scenario =====
  {
    id:35, type:"single", topic:"Nutrition",
    prompt:"A patient reports losing 12 lb unintentionally in 2 months and has poor appetite. Which assessment finding best supports risk of malnutrition?",
    options:["BMI of 27","Unintentional weight loss","High HDL","Thick hair texture"],
    ans:1,
    rat:"Unintentional weight loss is a strong clinical indicator of malnutrition risk."
  },

  // ===== Communication scenario =====
  {
    id:36, type:"single", topic:"Therapeutic Communication",
    prompt:"A patient says, “I’m scared about my surgery tomorrow.” Which response is most therapeutic?",
    options:[
      "“Don’t worry, you’ll be fine.”",
      "“Everyone feels that way.”",
      "“Tell me what worries you most.”",
      "“Let’s focus on getting your vitals now.”"
    ],
    ans:2,
    rat:"Open-ended exploration supports expression and assessment of concerns."
  },

  // ===== More meds / safety / routes =====
  {
    id:37, type:"single", topic:"Do Not Crush",
    prompt:"A patient has an order for an enteric-coated medication but cannot swallow tablets. What should the nurse do?",
    options:[
      "Crush the tablet and mix with applesauce",
      "Split the tablet in half and crush one half",
      "Hold the dose and contact provider/pharmacy for an alternative",
      "Dissolve the tablet in hot water"
    ],
    ans:2,
    rat:"Enteric-coated/ER meds should not be crushed; request alternate formulation."
  },
  {
    id:38, type:"single", topic:"Enteral Tube Meds",
    prompt:"A patient receives multiple medications via feeding tube. Which is best practice?",
    options:[
      "Mix all crushed meds together to reduce flushes",
      "Flush tube between each medication",
      "Stop checking residuals forever once the tube is placed",
      "Administer meds with formula to improve absorption"
    ],
    ans:1,
    rat:"Flush between each medication to prevent clogging and interactions."
  },

  // ===== Sleep physiology (common slide content) =====
  {
    id:39, type:"single", topic:"Sleep",
    prompt:"A nurse is teaching about sleep. Deep sleep begins in which stage?",
    options:["NREM stage 1","NREM stage 2","NREM stage 3","REM"],
    ans:2,
    rat:"Deep sleep begins in NREM stage 3."
  },

  // ===== Add a few more calculation scenarios for speed (often on finals) =====
  {
    id:40, type:"numeric", topic:"Dosage Calc",
    prompt:"Order: morphine 6 mg IV. Supply: 10 mg/mL. Round to nearest tenth. How many mL will the nurse administer?",
    ansN:{v:0.6,t:0.05},
    rat:"6 mg ÷ 10 mg/mL = 0.6 mL."
  },
  {
    id:41, type:"numeric", topic:"Dosage Calc",
    prompt:"Order: heparin 5,000 units subcut. Supply: 10,000 units/mL. Round to nearest tenth. How many mL?",
    ansN:{v:0.5,t:0.05},
    rat:"5000 ÷ 10000 = 0.5 mL."
  },
  {
    id:42, type:"numeric", topic:"Dosage Calc",
    prompt:"Order: ampicillin 500 mg IM. Supply: 250 mg/mL. Round to whole number. How many mL?",
    ansN:{v:2,t:0},
    rat:"500 ÷ 250 = 2 mL."
  },

  // ===== Priority/ABCs integrated scenarios =====
  {
    id:43, type:"single", topic:"Priority (ABCs)",
    prompt:"Four patients call at once. Who should the nurse see first?",
    options:[
      "A patient requesting pain medication for 6/10 incision pain",
      "A post-op patient with sudden shortness of breath and new wheezing",
      "A patient asking for help to the bathroom",
      "A stable patient with nausea after breakfast"
    ],
    ans:1,
    rat:"ABCs—new SOB/wheezing suggests airway/breathing compromise."
  },
  {
    id:44, type:"single", topic:"Fluid Excess Priority",
    prompt:"A patient with HF has ankle edema, BP 150/88, and new crackles with dyspnea. What is the priority concern?",
    options:["Peripheral edema","Hypertension","Impaired gas exchange","Need for diet teaching"],
    ans:2,
    rat:"Crackles + dyspnea indicates pulmonary congestion affecting breathing—priority."
  },
  {
    id:45, type:"single", topic:"Fluid Deficit Priority",
    prompt:"A dehydrated patient has dry mucosa and dizziness. Which finding is most concerning?",
    options:["Thirst","Poor skin turgor","Systolic BP 84 with dizziness","Dry lips"],
    ans:2,
    rat:"Hypotension with symptoms suggests poor perfusion/shock risk."
  },

  // ===== Patient identity / safety scenario =====
  {
    id:46, type:"single", topic:"Patient Identification",
    prompt:"Before giving medication, which is the best way to identify the patient?",
    options:[
      "Ask the patient their room number",
      "Compare the patient’s name and DOB on wristband to the MAR",
      "Ask the patient if they are here for surgery",
      "Ask a family member to confirm identity"
    ],
    ans:1,
    rat:"Use two identifiers and compare to MAR/wristband. Room number is not an identifier."
  },

  // ===== EOL comfort scenario =====
  {
    id:47, type:"single", topic:"End-of-Life Care",
    prompt:"A hospice patient asks for pain medication more frequently. Family expresses fear of addiction. Best nursing response?",
    options:[
      "“We should avoid opioids to prevent addiction.”",
      "“Addiction is not the priority at end-of-life; comfort and symptom relief are.”",
      "“We will give medication only if the family agrees.”",
      "“Try relaxation only; medications should be stopped.”"
    ],
    ans:1,
    rat:"End-of-life care prioritizes comfort; addiction is not the primary concern."
  },

  // ===== Interpreter/culture scenario =====
  {
    id:48, type:"single", topic:"Interpreter Use",
    prompt:"A patient with limited English nods but looks confused during teaching. Best action?",
    options:[
      "Speak louder and slower",
      "Use the adult child to interpret sensitive topics",
      "Request a qualified medical interpreter",
      "Provide written materials in English only"
    ],
    ans:2,
    rat:"Qualified interpreters improve accuracy and safety; family interpreters are not ideal for clinical teaching."
  },

  // ===== Medication documentation scenario =====
  {
    id:49, type:"single", topic:"Medication Documentation",
    prompt:"Best practice for documenting medication administration is to chart:",
    options:[
      "Before administration to save time",
      "After administration, including route/site if applicable and response when required",
      "At the end of the shift",
      "Only if the patient has side effects"
    ],
    ans:1,
    rat:"Chart after giving; include required details (time, route, site, response when appropriate)."
  },

  // ===== Rectal contraindication scenario =====
  {
    id:50, type:"single", topic:"Rectal Route Contraindications",
    prompt:"A nurse considers giving a rectal suppository for constipation. Which condition is a contraindication?",
    options:[
      "History of hypertension",
      "Swollen, inflamed hemorrhoids",
      "Mild nausea",
      "Hyperlipidemia"
    ],
    ans:1,
    rat:"Rectal route can traumatize inflamed hemorrhoids and increase bleeding/pain."
  },

  // ===== SATA mixed review: what to report immediately =====
  {
    id:51, type:"sata", topic:"Report Immediately",
    prompt:"Which findings should the nurse report immediately? (Select all that apply.)",
    options:[
      "New stridor after a first dose of medication",
      "SpO₂ 88% with increased work of breathing",
      "Pain 4/10 controlled with repositioning",
      "Sudden confusion in an older adult",
      "Mild nausea after oral medication"
    ],
    ans:[0,1,3],
    rat:"Airway compromise, significant hypoxia/work of breathing, and acute mental status change require urgent follow-up."
  },

  // ===== Add 9 more scenario questions to complete 60 (broad fundamentals) =====
  {
    id:52, type:"single", topic:"SBAR",
    prompt:"A nurse calls the provider about a patient whose BP dropped from 128/76 to 90/54 and is dizzy. Which is the 'Assessment' part of SBAR?",
    options:[
      "“I’m calling about Mr. J who feels dizzy.”",
      "“He had vomiting overnight and poor intake.”",
      "“I think he is dehydrated and may be hypovolemic.”",
      "“Can we obtain IV fluids and orthostatic vitals?”"
    ],
    ans:2,
    rat:"Assessment is your clinical interpretation of findings."
  },
  {
    id:53, type:"single", topic:"Health Promotion",
    prompt:"Which is an example of secondary prevention?",
    options:["Flu vaccination campaign","Teaching hand hygiene","BP screening at a community fair","Cardiac rehab after MI"],
    ans:2,
    rat:"Secondary prevention = early detection via screening."
  },
  {
    id:54, type:"single", topic:"Teaching Materials",
    prompt:"A nurse provides written instructions. Which is best practice?",
    options:[
      "Use medical jargon so it matches the chart",
      "Use small print to fit more information",
      "Use plain language and confirm understanding with teach-back",
      "Avoid pictures to prevent confusion"
    ],
    ans:2,
    rat:"Plain language + teach-back improves comprehension and retention."
  },
  {
    id:55, type:"single", topic:"Skin Integrity",
    prompt:"A patient has nonblanchable redness over the heel with intact skin. This finding is most consistent with:",
    options:["Stage 1 pressure injury","Stage 2 pressure injury","Stage 3 pressure injury","Skin tear"],
    ans:0,
    rat:"Stage 1 = nonblanchable erythema, intact skin."
  },
  {
    id:56, type:"single", topic:"Diabetes Safety",
    prompt:"A patient with diabetes is diaphoretic, shaky, and confused. What should the nurse do first?",
    options:["Give rapid-acting carbohydrate and recheck glucose","Administer long-acting insulin","Encourage walking to lower glucose","Call dietary for a low-sugar tray"],
    ans:0,
    rat:"Symptoms suggest hypoglycemia—treat immediately with rapid carbohydrate if safe to swallow."
  },
  {
    id:57, type:"single", topic:"Medication Administration",
    prompt:"A nurse finds a medication error after giving a dose. What is the priority action?",
    options:["Complete incident report first","Assess the patient and notify provider per policy","Hide the error to avoid punishment","Wait to see if symptoms develop"],
    ans:1,
    rat:"Patient safety first: assess, notify provider/charge nurse, then follow reporting policy."
  },
  {
    id:58, type:"single", topic:"Pain Reassessment",
    prompt:"After IV opioid administration, when should the nurse reassess pain for effectiveness (typical)?",
    options:["Immediately","Within about 15–30 minutes","In 2 hours","Next shift"],
    ans:1,
    rat:"IV analgesics have rapid onset; reassess within ~15–30 minutes per policy."
  },
  {
    id:59, type:"single", topic:"Bowel Elimination",
    prompt:"A patient on opioids reports no BM in 3 days. Which teaching is most appropriate?",
    options:["Decrease fluids to reduce bloating","Increase fiber/fluids as allowed and use stool softener as ordered","Avoid walking to conserve energy","Skip laxatives completely"],
    ans:1,
    rat:"Opioids cause constipation; prevention includes fluids/fiber/activity and stool softeners/laxatives as ordered."
  },
  {
    id:60, type:"single", topic:"Patient Safety",
    prompt:"A confused patient tries to climb out of bed repeatedly. Which intervention best reduces fall risk?",
    options:["Raise all 4 side rails","Place call light out of reach so patient won’t move","Use frequent rounding, bed low, alarm per policy, and place needed items within reach","Leave patient alone to promote independence"],
    ans:2,
    rat:"Use least restrictive safety measures: low bed, alarms per policy, rounding, and environment setup."
  }
];

// ================== Engine ==================
function shuffle(arr){ const a=arr.slice(); for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
function arraysEqual(a,b){ if(a.length!==b.length) return false; for(let i=0;i<a.length;i++) if(a[i]!==b[i]) return false; return true; }
function esc(str){ return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"); }

const state = { order: [], idx: 0, answers: new Map(), timerOn:false, timerSec:0, tick:null, startTs:null };

function renderStart(){
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>Fundamentals of Care — Scenario Mastery Exam (60)</h1>
    <div class="muted">Descriptive patient scenarios • MCQ + SATA + calculations • Rationales • Retest missed only</div>
    <div class="hr"></div>
    <div class="row">
      <button class="btn good" id="start">Start (Shuffled)</button>
      <button class="btn secondary" id="startFixed">Start (In Order)</button>
      <button class="btn" id="startTimed">Start Timed (75 min)</button>
      <span class="pill" id="timer"></span>
    </div>
    <div class="hr"></div>
    <div class="tiny">Numeric: enter numeric only. SATA is all-or-nothing (typical exam scoring).</div>
  `;
  document.getElementById("start").onclick = ()=>startExam(true,false,75);
  document.getElementById("startFixed").onclick = ()=>startExam(false,false,75);
  document.getElementById("startTimed").onclick = ()=>startExam(true,true,75);
}

function startExam(shuffleOrder=true, timed=false, minutes=75){
  state.order = QUESTIONS.map(q=>q.id);
  if(shuffleOrder) state.order = shuffle(state.order);
  state.idx = 0;
  state.answers.clear();
  state.startTs = Date.now();
  state.timerOn = timed;
  state.timerSec = minutes*60;
  if(state.tick) clearInterval(state.tick);
  if(timed){
    state.tick = setInterval(()=>{
      state.timerSec--;
      if(state.timerSec<=0){
        clearInterval(state.tick);
        renderResults();
      } else renderTimer();
    },1000);
  }
  renderQuestion();
}

function renderTimer(){
  const el = document.getElementById("timer");
  if(!el) return;
  if(!state.timerOn){ el.textContent=""; return; }
  const m = Math.floor(state.timerSec/60);
  const s = state.timerSec%60;
  el.textContent = `Time: ${m}:${String(s).padStart(2,"0")}`;
}

function getQ(){
  const id = state.order[state.idx];
  return QUESTIONS.find(q=>q.id===id);
}

function formatCorrect(q){
  if(q.type==="single") return q.options[q.ans];
  if(q.type==="sata") return q.ans.map(i=>q.options[i]).join("; ");
  if(q.type==="numeric") return String(q.ansN.v);
  return "";
}

function grade(q){
  if(q.type==="single"){
    const c = document.querySelector('input[type="radio"][name="opt"]:checked');
    const user = c ? Number(c.value) : null;
    return { user, correct: user===q.ans, correctAnswer:q.ans };
  }
  if(q.type==="sata"){
    const picked = Array.from(document.querySelectorAll('input[type="checkbox"][name="opt"]:checked'))
      .map(x=>Number(x.value)).sort((a,b)=>a-b);
    const key = q.ans.slice().sort((a,b)=>a-b);
    return { user:picked, correct: arraysEqual(picked,key), correctAnswer:key };
  }
  if(q.type==="numeric"){
    const raw = document.getElementById("numInput").value.trim();
    const v = Number(raw);
    const key = q.ansN.v;
    const tol = q.ansN.t ?? 0;
    const correct = Number.isFinite(v) && Math.abs(v-key) <= tol;
    return { user: raw, correct, correctAnswer: key };
  }
}

function lockInputs(q){
  if(q.type==="numeric") document.getElementById("numInput").disabled = true;
  else document.querySelectorAll('input[name="opt"]').forEach(x=>x.disabled=true);
}

function restore(q, user){
  if(q.type==="numeric"){
    document.getElementById("numInput").value = user ?? "";
  } else if(q.type==="single"){
    const el = document.querySelector(`input[type="radio"][name="opt"][value="${user}"]`);
    if(el) el.checked = true;
  } else {
    (user||[]).forEach(i=>{
      const el = document.querySelector(`input[type="checkbox"][name="opt"][value="${i}"]`);
      if(el) el.checked = true;
    });
  }
}

function renderQuestion(){
  const q = getQ();
  const app = document.getElementById("app");
  const progress = `${state.idx+1} / ${state.order.length}`;
  let html = `
    <div class="row" style="justify-content:space-between;">
      <div class="row">
        <span class="pill">Question ${progress}</span>
        <span class="pill">${esc(q.topic)}</span>
        <span class="pill" id="timer"></span>
      </div>
      <button class="btn secondary" id="endBtn">End & Review</button>
    </div>
    <div class="qtext"><strong>${esc(q.prompt)}</strong></div>
  `;

  if(q.type==="single" || q.type==="sata"){
    const t = q.type==="single" ? "radio" : "checkbox";
    html += `<div class="opts" id="opts">`;
    q.options.forEach((opt,i)=>{
      html += `<label class="opt"><input type="${t}" name="opt" value="${i}"><div>${esc(opt)}</div></label>`;
    });
    html += `</div>`;
  } else {
    html += `
      <div class="row">
        <input class="inputbox mono" id="numInput" inputmode="decimal" placeholder="Enter number only (no units)" />
      </div>
      <div class="tiny" style="margin-top:6px;">Follow the rounding instruction in the stem.</div>
    `;
  }

  html += `
    <div class="hr"></div>
    <div class="row" style="justify-content:space-between;">
      <button class="btn secondary" id="prevBtn" ${state.idx===0?"disabled":""}>Back</button>
      <div class="row">
        <button class="btn" id="checkBtn" disabled>Check</button>
        <button class="btn good" id="nextBtn" disabled>Next</button>
      </div>
    </div>
    <div id="fbSlot"></div>
  `;

  app.innerHTML = html;
  renderTimer();

  document.getElementById("endBtn").onclick = ()=>renderResults();
  document.getElementById("prevBtn").onclick = ()=>{ state.idx--; renderQuestion(); };

  const checkBtn = document.getElementById("checkBtn");
  const nextBtn  = document.getElementById("nextBtn");

  function enableCheck(){
    let answered = false;
    if(q.type==="single") answered = !!document.querySelector('input[type="radio"][name="opt"]:checked');
    else if(q.type==="sata") answered = document.querySelectorAll('input[type="checkbox"][name="opt"]:checked').length>0;
    else answered = document.getElementById("numInput").value.trim().length>0;
    checkBtn.disabled = !answered;
  }

  if(q.type==="numeric") document.getElementById("numInput").addEventListener("input", enableCheck);
  else document.getElementById("opts").addEventListener("change", enableCheck);

  checkBtn.onclick = ()=>{
    const res = grade(q);
    state.answers.set(q.id, res);
    showFeedback(q, res);
    lockInputs(q);
    checkBtn.disabled = true;
    nextBtn.disabled = false;
  };

  nextBtn.onclick = ()=>{
    if(state.idx < state.order.length-1){ state.idx++; renderQuestion(); }
    else renderResults();
  };

  const existing = state.answers.get(q.id);
  if(existing){
    restore(q, existing.user);
    lockInputs(q);
    showFeedback(q, existing);
    checkBtn.disabled = true;
    nextBtn.disabled = false;
  }
}

function showFeedback(q, res){
  const slot = document.getElementById("fbSlot");
  const cls = res.correct ? "good" : "bad";
  let correctLine = "";
  if(!res.correct){
    correctLine = `<div class="tiny"><span class="tag">Correct</span>${esc(formatCorrect(q))}</div>`;
  }
  slot.innerHTML = `
    <div class="feedback ${cls}">
      <div><strong>${res.correct ? "Correct" : "Incorrect"}</strong></div>
      ${correctLine}
      <div class="tiny" style="margin-top:6px;"><span class="tag">Rationale</span>${esc(q.rat)}</div>
    </div>
  `;
}

function renderResults(){
  if(state.tick) clearInterval(state.tick);
  const total = state.order.length;
  let correct = 0;
  const missed = [];
  state.order.forEach(id=>{
    const q = QUESTIONS.find(x=>x.id===id);
    const res = state.answers.get(id) || {correct:false};
    if(res.correct) correct++;
    else missed.push(id);
  });
  const pct = Math.round((correct/total)*100);
  const minutesUsed = Math.round((Date.now()-state.startTs)/60000);

  document.getElementById("app").innerHTML = `
    <h1>Results — Scenario Mastery Exam</h1>
    <div class="row">
      <span class="pill">Score: <strong>${correct}/${total}</strong> (${pct}%)</span>
      <span class="pill">Missed: ${missed.length}</span>
      <span class="pill">Time used: ${minutesUsed} min</span>
    </div>
    <div class="hr"></div>
    <div class="row">
      <button class="btn good" id="restart">Restart (Shuffled)</button>
      <button class="btn bad" id="retest" ${missed.length===0?"disabled":""}>Retest Missed Only</button>
      <button class="btn secondary" id="home">Home</button>
    </div>
    <div class="hr"></div>
    <div class="tiny">Retest missed only until you can clear them in one pass — that’s how you turn the final into a formality.</div>
  `;

  document.getElementById("restart").onclick = ()=>startExam(true,false,75);
  document.getElementById("home").onclick = ()=>renderStart();
  document.getElementById("retest").onclick = ()=>{
    state.order = missed.slice();
    state.idx = 0;
    state.answers.clear();
    state.timerOn = false;
    renderQuestion();
  };
}

renderStart();
</script>
</body>
</html>
